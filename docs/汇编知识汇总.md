# 汇编知识

## 常用的寄存器

- dx通用寄存器

  - 用于存储16位的数据。在CPU的编程中，DX寄存器常被用于存储数据的内存地址、端口地址、循环计数器以及其他各种用途。它通常与AX寄存器一起使用，来进行数据的传输和操作。在汇编语言程序中，可以使用特定的指令来读取和写入DX寄存器中的值，以完成相应的计算和操作。
- ax通用寄存器

  - AX寄存器是x86架构的CPU中的一个通用寄存器，用于存储16位的数据。它是寄存器组中最常用的寄存器之一，常被用于存放一些重要的数据、操作数和计算结果。在汇编语言程序中，可以使用特定的指令来读取和写入AX寄存器中的值，以完成相应的计算和操作。

  - AX寄存器可以分为两个独立的8位寄存器，即AH（高位）和AL（低位）。AH寄存器用于存储AX寄存器的高8位数据，而AL寄存器用于存储AX寄存器的低8位数据。这种拆分的设计使得AX寄存器在进行8位数据的操作时更加灵活。
- 汇编地址位数解析
  
  - 0b1111与0b0000_1111是等价的
  - 从右到左从0位开始，最右边是最小位

- 特殊例如（段地址）寄存器只能通过通用寄存器来间接赋值，意为先将值放入通用寄存器，再通过通用寄存器来给段地址赋值

## 常用指令解析

- out与in指令

  - out IO端口，寄存器
  - in  寄存器，端口
- shr指令

  - shr 寄存器，n
  - 将寄存器的数据右移n位
- 逻辑指令

  - and指令
    - 与指令 将每一位进行判断相同为一不同为0，
  - or指令
    - 或指令  
  - xor指令
    - 异或指令
- 跳转指令

  - 无条件跳转

    - jmp指令+.标记   跳转到那个标记
    - jmp 段地址：偏移地址 跳转到这个地址
  - 有条件跳转
  
    - jnz指令 判断cmp语句的ZF标志位为0的话执行跳转
    - jz指令 为 1的话执行跳转
    - jc指令 根据CF为选择是否跳转，如果为1的话执行跳转
    - jnc指令 根据CF为选择是否跳转，如果为0的话执行跳转
- 比较指令

  - cmp指令
    - 会将比较的结果存入标志位，一般与条件跳转指令相结合
    - 不仅可以比较寄存器与字符，还可以比较一个内存中的数据不过要指明单位，也就是大小
    - 例 cmp word [0x1000],0x55aa，将存在0x1000区域的字和0x55aa比较

- 系统调用指令

  - int 系统调用号
- 循环指令

  - 根据cx或ecx的值来判断loop的执行次数 ，每次执行就-1，直到cx或ecx值改为0，结束循环 

## linux指令

- dd if=loader.bin of=master.img bs=512 count=4 seek=2 conv=notrunc
从第二个扇区开始写4个扇区
- %.bin: %.asm
  - nasm -f bin $< -o $@
  - 模式匹配，不固定文件名，只要是bin与.asm类型的文件在makefile里直接传入

## 如何从主引导区域跳转到内核驱动器
  
- 在进行寄存器配置时，填入硬盘所在的区域以及大小
  - 这一部分是将内核驱动器的代码输出到0x1000区域
  - mov ecx，2 从第2个扇区开始
  - mov bl，4 一共有4个扇区
- 如何实现跳转
  - cmp word [0x1000],0x55aa;判断主引导扇区的正确性
  - jnz error
  - jmp 0:0x1002;跳转到loading文件写入硬盘的区域去执行loading.bin
  