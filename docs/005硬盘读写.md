# 硬盘读写

## 硬盘读写的两种模式

- CHS 模式
- LBA 模式 逻辑块地址

### LBA模式的端口

| Primary 通道 | in操作 | out操作 |
| ------- | ------- | ------- |
| 0x1F0 | data | data |
| 0x1F1 | Error | features |
| 0x1F2 | Sector count | Sector count |
| 0x1F3 | LBW low | LBW low |
| 0x1F4 | LBA mid | LBA mid |
| 0x1F5 | LBA high | LBA high |
| 0x1F6 | Device | Device |
| 0x1F7 | Status | Command |

- 0x1F0:16bit 端口，用于读写数据，需要的数据储存在这里
- 0x1F1：检测前一个指令的错误
- 0x1F0  
    16bit端口，用于读写数据

- 0x1F1
    检测前一个指令的错误（无用）

- 0x1F2
    读写扇区的数量

- 0x1F3
    起始扇区的前8位

- 0x1F4
    中8位

- 0x1F5
    后八位

- 0x1F6
    0到3位 起始扇区的24到27位
    第四位 判断主盘和从片，0为主盘，1为从片
    5和7位默认为1
    第6为为1，指的是设置为LBA模式，0的话为CHS模式

- 0x1F7
    out
        0xEC   识别硬盘
        0x20  读取硬盘
        0x30  写硬盘

    in  8bit的数据
        0位   ERR错误标记
        3位  数据准备完毕标记 准备完毕为1
        7位 BSY  硬盘繁忙 繁忙为0，不忙为1
