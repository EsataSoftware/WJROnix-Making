# 029中断函数

## 简介

- 内中断
  - 软中断
    - 系统调用：读写文件
  - 异常
    - 除零异常
    - 指令错误
    - 缺页错误
- 外中断
  - 时钟中断
    - 用来控制进程执行时间的基本中断
  - 键盘中断
  - 硬盘中断
    - 同步端口IO
    - 异步端口IO
    - DMA

## 生概念解读

### 键盘中断

    读取键盘数据，处理键盘数据，传递数据给操作系统：，恢复执行，键盘中断允许计算机系统实时响应用户的键盘输入，并使用户能够与计算机进行交互，执行各种操作和命令。

### 硬盘中断

    硬盘中断处理程序的功能通常包括以下几个方面：
    1：处理硬盘数据：硬盘中断处理程序会从硬盘控制器读取硬盘的状态和数据。它会检查硬盘操作的完成情况，或者读取从硬盘传输的数据。

    2：传递数据给操作系统：硬盘中断处理程序会将读取到的硬盘数据传递给操作系统的文件系统或其他相关部分。操作系统可以进一步处理这些数据，例如将其写入文件或将其传递给应用程序。

    处理错误：如果硬盘操作失败或发生错误，硬盘中断处理程序会处理错误情况，并通知操作系统或用户发生了什么错误。
    恢复执行：处理完硬盘中断后，主处理器会恢复执行之前暂停的程序或任务
  
### 同步端口IO（Synchronous Port I/O）

    同步端口 IO 是一种 IO 操作方式，其中程序执行被暂停，直到数据从外部设备读取到内存或从内存写入到外部设备。在同步端口 IO 中，CPU 通常会轮询或等待外部设备的状态变化，然后执行相应的 IO 操作。这种方式的 IO 操作通常是阻塞的，意味着程序会等待 IO 操作完成后才能继续执行。

### 异步端口IO（Asynchronous Port I/O）

    异步端口 IO 是一种 IO 操作方式，其中程序执行不会被阻塞，而是可以继续执行其他任务，而 IO 操作在后台进行。在异步端口 IO 中，程序会向外部设备发出 IO 请求，然后继续执行其他任务，当 IO 操作完成时，外部设备会通知 CPU，然后 CPU 再处理 IO 完成的数据。这种方式的 IO 操作通常是非阻塞的，允许程序执行其他任务，提高了系统的并发性和响应性。

### DMA（Direct Memory Access）

    DMA 是一种技术，允许外部设备（如硬盘控制器、网卡等）直接访问计算机的内存，而无需 CPU 的干预。使用 DMA，外部设备可以在数据传输过程中直接读取或写入内存，而不需要 CPU 介入。这样可以大大提高数据传输的效率，减轻了 CPU 的负担，同时也提高了系统的响应速度。DMA 技术常用于大数据传输，例如硬盘读写、网络数据传输等。

## 中断函数

    调用普通函数

- call / ret

  - eip

- int(interrupt) / iret(interrupt return )
  
  - eip
  - cs
  - eflags

## 中断向量表

    实模式下的最简单中断
    
    中断向量是中断函数的指针指向具体的中断函数
    
    `0x000`~`0x3ff`
    
    四个字节表示一个中断向量，总共有 256 个中断函数指针

    实模式下的寻址方式 
    
    段地址右移 4位(ip) + 偏移地址(cs)

## 引发触发

- int nr;(0 ~ 255)

## 内存分段

16bit 能访问 64k 内存

32bit 访问 4G 内存

### 注意

    在写中断的时候需要将段地址和偏移地址mov到对应的位置，
